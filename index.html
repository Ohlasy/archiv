<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <title>Ohlasy | Archiv</title>
    <link href="http://ohlasy.info/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://ohlasy.info/style/shared.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="archiv.js"></script>
</head>
<body>
    <div class="container">
        <div id="controls"></div>
        <hr>
        <script>
        function renderArticles(articles) {
            var mountNode = $('.results')
            mountNode.empty()
            $.each(articles, function(index, elem) {
                var div = $('<div/>', {'class': 'article'})
                var link = $('<a/>', {
                    'href': 'http://ohlasy.info' + elem.relativeURL
                })
                link.append($('<h2/>').html(elem.title))
                div.append(link)
                div.append($('<p/>').html(elem.perex))
                mountNode.append(div)
            })
        }
        $.getJSON('http://ohlasy.info/api/articles.js', function(data) {
            var controls = document.getElementById('controls')
            var reload = function(items) { renderArticles(items) }
            var filters = {}
            // Authors
            var authors = collectPropertyValues(data, 'author')
            var authorFilterBox = buildComboBox(authors, 'Autor')
            authorFilterBox.onchange = buildPropertyFilter('author', filters, data, reload)
            controls.appendChild(authorFilterBox)
            // Categories
            var categories = collectPropertyValues(data, 'category')
            var categoryFilterBox = buildComboBox(categories, 'Rubrika')
            categoryFilterBox.onchange = buildPropertyFilter('category', filters, data, reload)
            controls.appendChild(categoryFilterBox)
            // Serials
            var serials = collectPropertyValues(data, 'serial')
            var serialFilterBox = buildComboBox(serials, 'Seri√°l')
            serialFilterBox.onchange = buildPropertyFilter('serial', filters, data, reload)
            controls.appendChild(serialFilterBox)
            // Render
            reload(data)
        })
        </script>
        <div class="results"></div>
    </div>
</body>
</html>
